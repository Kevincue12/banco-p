<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bancos Registrados</title>
    <link rel="stylesheet" href="/static/estilos.css">
</head>

<body>
    <header>
        <nav class="nav">
            <h2 class="logo">üè¶ Bancos Registrados</h2>
            <ul>
                <li><a href="/">Inicio</a></li>
                <li><a href="/banco">Administrar Banco</a></li>
            </ul>
        </nav>
    </header>

    <section class="container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Direcci√≥n</th>
                    <th>Categor√≠as</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tabla-bancos"></tbody>
        </table>
    </section>

    <!-- üî¥ FORMULARIO APARTE PARA LIMPIAR INVENTARIO POR ID -->
    <section class="container" style="margin-top:20px;">
        <h3>Limpiar Inventario de Banco</h3>
        <form id="form-limpiar">
            <input type="number" id="banco-id-limpiar" placeholder="ID del banco a limpiar">
            <button type="submit">üßπ Limpiar Inventario</button>
        </form>
    </section>

    <!-- üî¥ FORMULARIO APARTE PARA ELIMINAR BANCO POR ID -->
    <section class="container" style="margin-top:20px;">
        <h3>Eliminar Banco</h3>
        <form id="form-eliminar">
            <input type="number" id="banco-id-eliminar" placeholder="ID del banco a eliminar">
            <button type="submit">‚ùå Eliminar Banco</button>
        </form>
    </section>

    <script>
        async function cargarBancos() {
            const res = await fetch("/api/bancos/listar");
            const bancos = await res.json();

            const tabla = document.getElementById("tabla-bancos");
            tabla.innerHTML = "";

            bancos.forEach(b => {
                let categoriasHTML = "<table class='subtabla'><tr><th>Tipo</th><th>Capacidad</th><th>Usado</th><th>Disponible</th></tr>";
                for (const tipo in b.categorias) {
                    const cat = b.categorias[tipo];
                    const disponible = cat.capacidad - cat.usado;
                    categoriasHTML += `
                        <tr>
                            <td>${tipo}</td>
                            <td>${cat.capacidad}</td>
                            <td>${cat.usado}</td>
                            <td>${disponible}</td>
                        </tr>
                    `;
                }
                categoriasHTML += "</table>";

                tabla.innerHTML += `
                    <tr>
                        <td>${b.id}</td>
                        <td>${b.nombre}</td>
                        <td>${b.direccion}</td>
                        <td>${categoriasHTML}</td>
                        <td>
                            <button class="btn btn-danger" onclick="limpiarBanco(${b.id})">
                                üßπ Limpiar Inventario
                            </button>
                            <button class="btn btn-warning" onclick="eliminarBanco(${b.id})">
                                ‚ùå Eliminar Banco
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        async function limpiarBanco(id) {
            if (!confirm(`¬øSeguro que quieres limpiar el inventario del banco con ID ${id}?`)) return;

            const res = await fetch(`/bancos/${id}/limpiar`, { method: "DELETE" });
            const data = await res.json();
            alert(data.mensaje);
            cargarBancos();
        }

        async function eliminarBanco(id) {
            if (!confirm(`¬øSeguro que quieres eliminar el banco con ID ${id}?`)) return;

            const res = await fetch(`/bancos/eliminar/${id}`, { method: "DELETE" });
            const data = await res.json();
            alert(data.mensaje);
            cargarBancos();
        }

        // Limpiar inventario desde formulario aparte
        const formLimpiar = document.getElementById("form-limpiar");
        if (formLimpiar) {
            formLimpiar.addEventListener("submit", async (e) => {
                e.preventDefault();
                const id = document.getElementById("banco-id-limpiar").value;
                if (!id) {
                    alert("Por favor ingresa el ID del banco a limpiar");
                    return;
                }
                await limpiarBanco(id);
            });
        }

        // Eliminar banco desde formulario aparte
        const formEliminar = document.getElementById("form-eliminar");
        if (formEliminar) {
            formEliminar.addEventListener("submit", async (e) => {
                e.preventDefault();
                const id = document.getElementById("banco-id-eliminar").value;
                if (!id) {
                    alert("Por favor ingresa el ID del banco a eliminar");
                    return;
                }
                await eliminarBanco(id);
            });
        }

        cargarBancos();
        async function limpiarBanco(id) {
    if (!confirm(`¬øSeguro que quieres limpiar el inventario del banco con ID ${id}?`)) return;

    const res = await fetch(`/bancos/${id}/limpiar`, { method: "DELETE" });
    const data = await res.json();
    alert(data.mensaje);
    cargarBancos();
}

async function eliminarBanco(id) {
    if (!confirm(`¬øSeguro que quieres eliminar el banco con ID ${id}?`)) return;

    const res = await fetch(`/bancos/eliminar/${id}`, { method: "DELETE" });
    const data = await res.json();
    alert(data.mensaje);
    cargarBancos();
}

    </script>
</body>
</html>