<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bancos Registrados</title>
    <link rel="stylesheet" href="/static/estilos.css">
</head>

<body>
    <header>
        <nav class="nav">
            <h2 class="logo">üè¶ Bancos Registrados</h2>
            <ul>
                <li><a href="/">Inicio</a></li>
                <li><a href="/banco">Administrar Banco</a></li>
            </ul>
        </nav>
    </header>

    <section class="container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Direcci√≥n</th>
                    <th>Categor√≠as</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tabla-bancos"></tbody>
        </table>
    </section>

    <script>
        async function cargarBancos() {
            const res = await fetch("/api/bancos/listar");
            const bancos = await res.json();

            const tabla = document.getElementById("tabla-bancos");
            tabla.innerHTML = "";

            bancos.forEach(b => {
                // Construir tabla interna para categor√≠as
                let categoriasHTML = "<table class='subtabla'><tr><th>Tipo</th><th>Capacidad</th><th>Usado</th><th>Disponible</th></tr>";
                for (const tipo in b.categorias) {
                    const cat = b.categorias[tipo];
                    const disponible = cat.capacidad - cat.usado;
                    categoriasHTML += `
                        <tr>
                            <td>${tipo}</td>
                            <td>${cat.capacidad}</td>
                            <td>${cat.usado}</td>
                            <td>${disponible}</td>
                        </tr>
                    `;
                }
                categoriasHTML += "</table>";

                tabla.innerHTML += `
                    <tr>
                        <td>${b.id}</td>
                        <td>${b.nombre}</td>
                        <td>${b.direccion}</td>
                        <td>${categoriasHTML}</td>
                        <td>
                            <button class="btn btn-danger" onclick="limpiarBanco(${b.id})">
                                üßπ Limpiar Inventario
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        async function limpiarBanco(id) {
            if (!confirm("¬øSeguro que quieres limpiar el inventario de este banco?")) return;

            const res = await fetch(`/bancos/${id}/limpiar`, {
                method: "DELETE"
            });
            const data = await res.json();
            alert(data.mensaje);

            // Recargar tabla
            cargarBancos();
        }

        cargarBancos();
    </script>
    <script src="/static/app.js"></script>
</body>
</html>